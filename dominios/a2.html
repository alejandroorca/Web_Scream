
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
<head>
  <meta charset="utf-8" />
  <title>Administración de dominios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="style.css" />
		<link rel="stylesheet" href="fonts.css"/>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript">

  
  $(document).ready(function(){
 
	$('.ir-arriba').click(function(){
		$('body, html').animate({
			scrollTop: '0px'
		}, 300);
	});
 
	$(window).scroll(function(){
		if( $(this).scrollTop() > 0 ){
			$('.ir-arriba').slideDown(300);
		} else {
			$('.ir-arriba').slideUp(300);
		}
	});
 
});
</script>    
</head>
<body>
<main>	
<nav>
							<ul>
								<li><a href="index.html">Principal</a></li>
								<li class="dropdown">
                                <a href="javascript:void(0)" class="dropbtn">A. Administración de dominios</a>
                                <div class="dropdown-content">
                                <a href="a1.html">Implementación de dominios</a>
								<a href="a2.html">Administración de cuentas de usuarios y de equipos</a>
								<a href="a3.html">Centralizar información</a>
								<a href="a4.html">Creación y administración de grupos de seguridad</a>
								<a href="a5.html">Creación de plantillas que facilitan la administración de usuarios</a>
								<a href="a6.html">Organización de los objetos del dominio</a>
								<a href="a7.html">Utilización de máquinas virtuales para la administración de dominios</a>
								<a href="a8.html">Documentación de la estructura del dominio y la tareas realizadas</a>
                                </div>
                                </li>
								<li class="dropdown">
                                <a href="javascript:void(0)" class="dropbtn">B. Administración del acceso al dominio</a>
                                <div class="dropdown-content">
                                <a href="b1.html">Equipos al dominio</a>
                                <a href="b2.html">Bloqueos de acceso no autorizados al dominio</a>
                                <a href="b3.html">Administración de recursos locales y de red</a>
                                <a href="b4.html">Se han tenido en cuenta los requerimientos de seguridad</a>
                                <a href="b5.html">Implementación y verificación de directivas de grupos</a>
                                <a href="b6.html">Asignación de directivas al grupo</a>
                                <a href="b7.html">Documentación de incidencias y de tareas</a>
								</div>
                                </li>
							</ul>
						</nav>
<h1>a.2) Administración de cuentas de usuarios y de equipos</h1>
<h2>Creación de usuario</h2>
<p><b>Para la creación de usuarios en el dominio deberemos de crear un script con los siguientes comandos:</b></p>
<p># En la primera línea se conecta al dominio. Esta línea requiere ser modificada.</p>
<p>$Path= "LDAP://CN=Users,DC=alorca,DC=1a"</p>
<p>$name = "Alejandro OC"</p>
<p>$NTname = "AlejandroOC"</p>
<p>$ou = New-Object Directoryservices.DirectoryEntry($Path)</p>
<p>$user = $ou.PSBase.Children.Add("CN=" + $name,'user')</p>
<p>$user.PSBase.CommitChanges()</p>
<p>$user.SAMAccountName = $NTname</p>
<p>$user.Description = "User_1"</p>
<p>$user.PSBase.CommitChanges()</p>
<p>$user.SetPassword("administracion")</p><br/>



<h2>EXPLICACIÓN PASO A PASO</h2>
<p>$Path= "LDAP://CN=Users,DC=alorca,DC=1a"</p>
<p><i>En esta línea me estoy conectando a mi dominio alorca.1a. Luego estoy entrando al contenedor users.</i></p>
<p>Para poder ver el nombre del dominio sólo basta con poner <i>sconfig</i></p>
<p>$name = "Alejandro OC"</p>
<p><i>Estamos definiendo como se llamará el usuario.</i></p>
<p>$NTname = "AlejandroOC"</p>
<p>$ou = New-Object Directoryservices.DirectoryEntry($Path)</p>
<p><i>En esta línea creamos un nuevo objeto (en este caso un usuario con el path establecido en la primera línea.</i></p>
<p>$user = $ou.PSBase.Children.Add("CN=" + $name,'user')</p>
<p><i>Estamos definiendo el nombre del usuario.</i></p>
<p>$user.PSBase.CommitChanges()</p>
<p><i>Guarda los cambios</i></p>
<p>$user.SAMAccountName = $NTname</p>
<p><i>Establece el tipo de cuenta.</i></p>
<p><p>$user.Description = "User_1"</p></p>
<p><i>Establece una descripción del usuario.</i></p>
<p>$user.SetPassword("administracion")</p>
<p><i>Establece una contraseña 'administracion'</i></p>

<p>Para obtener el script dentro del servidor, deberemos de usar el comando wget, para obtener el de esta web debes de poner el siguiente <a href="https://raw.githubusercontent.com/alejandroorca/alejandroorca.github.io/master/dominios/script.ps1">enlace</a>.</p>

<img src="Assets/script.jpg" alt="script" />

<p>Para visualizar las propiedades del usuario usamos el comando <i><b>Get-AdUser AlejandroOC -Properties *|more</b></i></p>

<img src="Assets/propiedades.jpg" alt="propiedades" />

<h2>Añadir equipos al dominio</h2>

<p>$Domain = 'alorca.1a'</p>
<p>$hostname = Read-Host -Prompt 'Nombre del equipo'</p>
<p>Rename-Computer $hostname</p>
<p>Add-computer -domainname $Domain -Credential instituto\gestor -newname $hostname -Restart</p>

<h2>EXPLICACIÓN PASO A PASO</h2>
<p>En una variable a la que hemos llamado "Domain" introducimos el nombre de nuestro dominio:</p>
<p>$Domain = 'alorca.1a'</p>
<p>En una variable a la que hemos llamado "hostname" introducimos el nombre del host,  pero en lugar de especificar su valor, solicitamos al usuario que lo introduzca mediante teclado:</p>
<p>$hostname = Read-Host -Prompt 'Nombre del equipo'</p>
<p>A continuación ejecutamos un cmdlet que nos permite renombar el equipo con el nombre almacenado en la variable $hostname:</p>
<p>Rename-Computer $hostname</p>
<p>Y, por último, ejecutamos el cmdlet que permite añadir el equipo al dominio:</p>
<p>Add-computer -domainname $Domain -Credential instituto\gestor -newname $hostname -Restart</p>
<p>En este último paso comentar dos cosas:</p>

<p>Una es que estamos especificando la credencial de un administrador cuyo nombre es "gestor" y pertenece al dominio "instituto" directamente en el comando (-Credential instituto\gestor). Si nos interesa más, podríamos solicitar al usuario que la introdujera por pantalla y la almacenamos en una variable y, posteriormente, usar la variable en el cmdlet Add-computer . Por ejemplo:</p>
<p>$Credential = Get-Credential</p>

<p>Otra, que estamos utilizando el parámetro -Restart para reiniciar el equipo justo después de cambiar el nombre, puesto que Windows requiere reiniciar para aplicar los cambios.</p>

<p>Para obtener el script dentro del servidor, deberemos de usar el comando wget, para obtener el de esta web debes de poner el siguiente <a href="https://raw.githubusercontent.com/alejandroorca/alejandroorca.github.io/master/dominios/script_1.ps1">enlace</a>.</p>

<img src="Assets/script_1.jpg" alt="script" />

</main> 
<span class="ir-arriba icon-arrow-up"></span>
</body>
</html>
